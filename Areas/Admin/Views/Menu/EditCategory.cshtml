@model HarborRestaurant.Entities.Concrete.MenuCategory
@{
    ViewData["Title"] = "Kategori Düzenle";
}

<div class="container-fluid py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h2 mb-0 text-dark">
                <i class="fas fa-edit text-warning me-2"></i>Kategori Düzenle
            </h1>
            <p class="text-muted mb-0">@Model.Name kategorisini düzenleyin</p>
        </div>
        <a href="@Url.Action("Categories")" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left me-1"></i>Geri Dön
        </a>
    </div>

    <div class="row g-4">
        <div class="col-lg-8">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white border-bottom-0 py-3">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-tags text-primary me-2"></i>Kategori Bilgileri
                    </h5>
                </div>
                <div class="card-body p-4">
                    <form asp-action="EditCategory" method="post" class="needs-validation" novalidate>
                        <div asp-validation-summary="ModelOnly" class="alert alert-danger rounded-3"></div>
                        
                        <input type="hidden" asp-for="CategoryId" />
                        <input type="hidden" asp-for="CreatedDate" />
                        
                        <div class="row g-3 mb-4">
                            <div class="col-md-8">
                                <label asp-for="Name" class="form-label fw-semibold">
                                    <i class="fas fa-signature me-1"></i>Kategori Adı *
                                </label>
                                <input asp-for="Name" class="form-control form-control-lg" 
                                       placeholder="Örn: Ana Yemekler, Başlangıçlar" required />
                                <span asp-validation-for="Name" class="invalid-feedback d-block"></span>
                            </div>
                            <div class="col-md-4">
                                <label asp-for="DisplayOrder" class="form-label fw-semibold">
                                    <i class="fas fa-sort-numeric-up me-1"></i>Sıralama
                                </label>
                                <input asp-for="DisplayOrder" class="form-control form-control-lg" type="number" min="0" />
                                <span asp-validation-for="DisplayOrder" class="invalid-feedback d-block"></span>
                                <div class="form-text">Küçük numara üstte görünür</div>
                            </div>
                        </div>

                        <div class="mb-4">
                            <label asp-for="Description" class="form-label fw-semibold">
                                <i class="fas fa-align-left me-1"></i>Açıklama
                            </label>
                            <textarea asp-for="Description" class="form-control" rows="4" 
                                      placeholder="Kategori hakkında kısa bilgi..." maxlength="500"></textarea>
                            <span asp-validation-for="Description" class="invalid-feedback d-block"></span>
                        </div>

                        <div class="mb-4">
                            <div class="form-check form-switch">
                                <input asp-for="IsActive" class="form-check-input" type="checkbox" role="switch" />
                                <label asp-for="IsActive" class="form-check-label fw-semibold">
                                    <i class="fas fa-toggle-on me-1"></i>Aktif durumda
                                </label>
                            </div>
                            <small class="text-muted">Pasif kategoriler menüde görünmez</small>
                        </div>

                        <div class="d-flex gap-2 justify-content-end">
                            <a href="@Url.Action("Categories")" class="btn btn-light px-4">
                                <i class="fas fa-times me-1"></i>İptal
                            </a>
                            <button type="submit" class="btn btn-warning px-4">
                                <i class="fas fa-save me-1"></i>Değişiklikleri Kaydet
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4">
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-info text-white py-3">
                    <h6 class="card-title mb-0">
                        <i class="fas fa-info-circle me-2"></i>Kategori Detayları
                    </h6>
                </div>
                <div class="card-body p-4">
                    <div class="row g-2">
                        <div class="col-5">
                            <small class="text-muted fw-semibold">ID:</small>
                        </div>
                        <div class="col-7">
                            <small class="badge bg-primary">#@Model.CategoryId</small>
                        </div>
                        
                        <div class="col-5">
                            <small class="text-muted fw-semibold">Oluşturma:</small>
                        </div>
                        <div class="col-7">
                            <small>@Model.CreatedDate.ToString("dd.MM.yyyy HH:mm")</small>
                        </div>
                        
                        @if (Model.UpdatedDate.HasValue)
                        {
                            <div class="col-5">
                                <small class="text-muted fw-semibold">Güncelleme:</small>
                            </div>
                            <div class="col-7">
                                <small>@Model.UpdatedDate.Value.ToString("dd.MM.yyyy HH:mm")</small>
                            </div>
                        }
                        
                        <div class="col-5">
                            <small class="text-muted fw-semibold">Durum:</small>
                        </div>
                        <div class="col-7">
                            @if (Model.IsActive)
                            {
                                <span class="badge bg-success rounded-pill">
                                    <i class="fas fa-check me-1"></i>Aktif
                                </span>
                            }
                            else
                            {
                                <span class="badge bg-danger rounded-pill">
                                    <i class="fas fa-times me-1"></i>Pasif
                                </span>
                            }
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-warning text-dark py-3">
                    <h6 class="card-title mb-0">
                        <i class="fas fa-exclamation-triangle me-2"></i>Önemli Bilgi
                    </h6>
                </div>
                <div class="card-body p-4">
                    <div class="alert alert-warning border-0 mb-0">
                        <small>
                            <i class="fas fa-lightbulb me-1"></i>
                            <strong>Dikkat:</strong> Bu kategoriye ait ürünler varsa, 
                            kategoriyi pasif hale getirdiğinizde o ürünler de müşteri 
                            menüsünde görünmeyecektir.
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    
    <script>
        $(document).ready(function() {
            // Bootstrap 5 validation
            (function() {
                'use strict';
                window.addEventListener('load', function() {
                    var forms = document.getElementsByClassName('needs-validation');
                    var validation = Array.prototype.filter.call(forms, function(form) {
                        form.addEventListener('submit', function(event) {
                            if (form.checkValidity() === false) {
                                event.preventDefault();
                                event.stopPropagation();
                            }
                            form.classList.add('was-validated');
                        }, false);
                    });
                }, false);
            })();
            
            // Enhanced form validation
            $('form').on('submit', function(e) {
                var name = $('#Name').val().trim();
                if (name.length < 2) {
                    e.preventDefault();
                    
                    Swal.fire({
                        icon: 'error',
                        title: 'Hata',
                        text: 'Kategori adı en az 2 karakter olmalıdır.',
                        confirmButtonText: 'Tamam',
                        confirmButtonColor: '#e74c3c'
                    });
                    
                    return false;
                } else {
                    // Show loading state
                    var submitBtn = $('button[type="submit"]');
                    submitBtn.prop('disabled', true)
                           .html('<i class="fas fa-spinner fa-spin me-1"></i>Kaydediliyor...');
                }
            });
            
            // Character counter for description
            $('#Description').on('input', function() {
                var length = $(this).val().length;
                var maxLength = 500;
                var remaining = maxLength - length;
                var targetId = 'DescriptionCounter';
                
                if (!$('#' + targetId).length) {
                    $(this).after('<small id="' + targetId + '" class="char-counter float-end mt-1"></small>');
                }
                
                var counter = $('#' + targetId);
                counter.text(remaining + ' karakter kaldı');
                
                if (remaining < 50) {
                    counter.removeClass('text-muted text-success').addClass('text-warning');
                } else if (remaining < 20) {
                    counter.removeClass('text-muted text-warning').addClass('text-danger');
                } else {
                    counter.removeClass('text-warning text-danger').addClass('text-muted');
                }
            });
            
            // Trigger character counter on page load
            $('#Description').trigger('input');
            
            // Real-time validation feedback
            $('input[required]').on('blur', function() {
                var $this = $(this);
                var isValid = this.checkValidity();
                
                if (isValid) {
                    $this.removeClass('is-invalid').addClass('is-valid');
                } else {
                    $this.removeClass('is-valid').addClass('is-invalid');
                }
            });
            
            // Switch animation
            $('.form-switch input').on('change', function() {
                var $switch = $(this);
                var $label = $switch.next('label');
                
                if ($switch.is(':checked')) {
                    $label.addClass('text-success');
                    setTimeout(function() {
                        $label.removeClass('text-success');
                    }, 300);
                }
            });
        });
    </script>
    
    <!-- SweetAlert2 for better alerts -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
}
