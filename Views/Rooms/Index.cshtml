@using Microsoft.Extensions.Localization
@inject IStringLocalizer<HarborRestaurant.SharedResource> Localizer
@model HarborRestaurant.Models.ViewModels.RoomsSearchViewModel
@{
    ViewData["Title"] = Localizer["Rooms.Title"];
}

<!-- Hero Section -->
<div class="hero-wrap" style="background-image: url('/images/bg_3.jpg');">
    <div class="overlay"></div>
    <div class="container">
        <div class="row no-gutters slider-text d-flex align-itemd-center justify-content-center">
            <div class="col-md-9 ftco-animate text-center d-flex align-items-end justify-content-center">
                <div class="text">
                    <p class="breadcrumbs mb-2"><span class="mr-2"><a href="@Url.Action("Index", "Home")">@Localizer["Nav.Home"]</a></span> <span>@Localizer["Rooms.Title"]</span></p>
                    <h1 class="mb-4 bread">@Localizer["Rooms.Title"]</h1>
                </div>
            </div>
        </div>
    </div>
</div>

<section class="ftco-section ftco-no-pb ftco-room">
    <div class="container-fluid px-0">
        <div class="row no-gutters justify-content-center mb-4 pb-2">
            <div class="col-lg-10 heading-section ftco-animate">
                <form class="p-3 bg-dark rounded text-white" method="get" asp-action="Index" asp-controller="Rooms">
                    <div class="row g-3 align-items-end">
                        <div class="col-md-3">
                            <label class="form-label">@Localizer["Rooms.Search.CheckIn"]</label>
                            <input type="date" class="form-control" name="CheckInDate" value="@Model.CheckInDate" />
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">@Localizer["Rooms.Search.CheckOut"]</label>
                            <input type="date" class="form-control" name="CheckOutDate" value="@Model.CheckOutDate" />
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">@Localizer["Rooms.Search.Time"]</label>
                            <input type="time" class="form-control" name="ReservationTime" value="@Model.ReservationTime" />
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">@Localizer["Rooms.Search.Guests"]</label>
                            <select class="form-select" name="GuestCount">
                                @for(int i=1;i<=10;i++){
                                    <option value="@i" selected="@(Model.GuestCount==i)">@i</option>
                                }
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">@Localizer["Rooms.Search.Find"]</label>
                            <button type="submit" class="btn btn-success w-100">@Localizer["Rooms.Search.Find"]</button>
                        </div>
                    </div>

                    <div class="row g-3 align-items-end mt-3">
                        <div class="col-md-3">
                            <label class="form-label">@Localizer["Rooms.Search.Query"]</label>
                            <input type="text" class="form-control" name="q" value="@Model.Q" placeholder="@Localizer["Rooms.Search.Query"]" />
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">@Localizer["Rooms.Search.MinPrice"]</label>
                            <input type="number" step="1" class="form-control" name="minPrice" value="@(Model.MinPrice?.ToString())" />
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">@Localizer["Rooms.Search.MaxPrice"]</label>
                            <input type="number" step="1" class="form-control" name="maxPrice" value="@(Model.MaxPrice?.ToString())" />
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">@Localizer["Rooms.Search.Stars"]</label>
                            <select class="form-select" name="star">
                                <option value="">@Localizer["Common.All"]</option>
                                @for(int s=5;s>=1;s--){
                                    <option value="@s" selected="@(Model.Star==s)">@s+ @Localizer["Common.Stars"]</option>
                                }
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">@Localizer["Rooms.Search.Sort"]</label>
                            <select class="form-select" name="sort">
                                <option value="">@Localizer["Common.Recommended"]</option>
                                <option value="price_asc" selected="@(Model.Sort=="price_asc")">@Localizer["Common.PriceAsc"]</option>
                                <option value="price_desc" selected="@(Model.Sort=="price_desc")">@Localizer["Common.PriceDesc"]</option>
                                <option value="star_desc" selected="@(Model.Sort=="star_desc")">@Localizer["Common.StarDesc"]</option>
                            </select>
                        </div>
                    </div>
                </form>
                @if (!string.IsNullOrEmpty(Model.CheckInDate) || !string.IsNullOrEmpty(Model.CheckOutDate) || Model.GuestCount > 0)
                {
                    <div class="bg-success bg-opacity-10 border border-success rounded p-2 mt-2 text-white-50">
                        <strong>@(Model.CheckInDate) - @(Model.CheckOutDate)</strong>
                        · <span>@Model.GuestCount @Localizer["Common.Person"]</span>
                        · <span>@(Model.Rooms?.Count() ?? 0) @Localizer["Common.Results"]</span>
                    </div>
                }
            </div>
        </div>
        <div class="row no-gutters">
            @if (Model?.Rooms != null && Model.Rooms.Any())
            {
                foreach (var room in Model.Rooms)
                {
                    <div class="col-lg-6">
                        <div class="room-wrap d-md-flex ftco-animate">
                            <a href="@Url.Action("Details", "Rooms", new { id = room.RoomId })" class="img @(room.RoomId % 2 == 0 ? "order-md-last" : "")" style="background-image: url('@(room.ImageUrl ?? "/images/room-1.jpg")');"></a>
                            <div class="half @(room.RoomId % 2 == 0 ? "right-arrow" : "left-arrow") d-flex align-items-center">
                                <div class="text p-4 text-center">
                                    <p class="star mb-0">
                                        @for (int i = 0; i < (room.StarRating > 0 ? room.StarRating : 5); i++)
                                        {
                                            <span class="ion-ios-star"></span>
                                        }
                                    </p>
                                    @if (room.MinimumOrderAmount.HasValue)
                                    {
                                        var geceler = Model.Nights;
                                        var toplam = (room.MinimumOrderAmount ?? 0) * geceler;
                                        <p class="mb-0 d-flex flex-column">
                                            <span class="price mr-1">₺@((room.MinimumOrderAmount ?? 0).ToString("N0"))</span>
                                            <small class="text-muted">@geceler @Localizer["Common.Nights"], 1 @Localizer["Common.Room"] @Localizer["Common.Total"] <strong>₺@toplam.ToString("N0")</strong></small>
                                        </p>
                                    }
                                    <h3 class="mb-3"><a href="@Url.Action("Details", "Rooms", new { id = room.RoomId })">@(System.Globalization.CultureInfo.CurrentCulture.Name == "en" && !string.IsNullOrEmpty(room.NameEn) ? room.NameEn : room.Name)</a></h3>
                                    <div class="d-flex align-items-center justify-content-center gap-2">
                                        <a href="@Url.Action("Details", "Rooms", new { id = room.RoomId })" class="btn-custom px-3 py-2 rounded">@Localizer["Rooms.ViewDetails"] <span class="icon-long-arrow-right"></span></a>
                                        <a href="@Url.Action("Index", "Reservation", new { RoomId = room.RoomId, CheckInDate = Model.CheckInDate, CheckOutDate = Model.CheckOutDate, ReservationTime = Model.ReservationTime, GuestCount = Model.GuestCount })" class="btn-custom px-3 py-2 rounded ms-2">@Localizer["Rooms.BookRoom"]</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="col-12 text-center py-5">
                    <p class="text-muted">Henüz aktif salon bulunamadı.</p>
                </div>
            }
        </div>
    </div>
</section>
